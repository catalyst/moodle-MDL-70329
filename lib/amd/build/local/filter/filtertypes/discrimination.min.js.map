{"version":3,"sources":["../../../../src/local/filter/filtertypes/discrimination.js"],"names":["INTERPRETATION","VALUES","RANGES","filterType","filterSet","initialValues","filterRange","interpretation","setUpRangeUi","then","displayRadio","catch","rootNode","querySelector","Selectors","filter","regions","range","filterInterpretation","document","createElement","setAttribute","Templates","render","html","innerHTML","parentNode","insertBefore","discriminationRadioListenner","placeholderOne","placeholderTwo","interpretationPlaceholder","filterRoot","discriminationSelect","getElementById","addEventListener","e","target","value","dataSource","inputHide","Object","entries","key","selectedOption","append","Autocomplete","enhance","layout","selection","removeAttribute","context","placeholderone","type","rangetype","placeholdertwo","displayRange","dataset","activeValue","split","interpretationRanges","rangeValue1","values","rangeValue2","push","parseInt","fields","Range"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Discrimination index filter.\n *\n * @module     core/local/filter/filtertypes/discrimination\n * @copyright  2022 Ghaly Marc-Alexandre <marc-alexandreghaly@catalyst-ca.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Autocomplete from 'core/form-autocomplete';\nimport Range from 'core/local/filter/range';\nimport Selectors from 'core/local/filter/selectors';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\n\nconst INTERPRETATION = {\n    VALUES: {\n        'Very good discrimination': 1,\n        'Adequate discrimination': 2,\n        'Weak discrimination': 3,\n        'Very weak discrimination': 4,\n        'Question probably invalid': 5,\n    },\n    RANGES: {\n        '1': '49',\n        '2': '30-49',\n        '3': '20-29',\n        '4': '0-19',\n        '5': '0'\n    }\n};\n\nexport default class extends Range {\n    constructor(filterType, filterSet, initialValues, filterRange) {\n        super(filterType, filterSet, initialValues, filterRange);\n        this.interpretation = false;\n        this.setUpRangeUi('number', initialValues).then(() => {\n            this.displayRadio();\n            return;\n        }).catch();\n    }\n\n    /**\n     * Displays radio inputs.\n     *\n     */\n    displayRadio() {\n        const filterRange = this.rootNode.querySelector(Selectors.filter.regions.range);\n        const filterInterpretation = document.createElement('div');\n        filterInterpretation.setAttribute('data-filterregion', 'interpretation');\n        Templates.render('qbank_statistics/discrimination_index_radio', {})\n        .then((html) => {\n            filterInterpretation.innerHTML = html;\n            filterRange.parentNode.insertBefore(filterInterpretation, filterRange);\n            return;\n        })\n        .then(() =>{\n            this.discriminationRadioListenner();\n            return;\n        })\n        .catch();\n    }\n\n    /**\n     * Adds listenner on radio inputs.\n     *\n     */\n    async discriminationRadioListenner() {\n        const placeholderOne = await this.placeholderOne;\n        const placeholderTwo = await this.placeholderTwo;\n        const interpretationPlaceholder = await this.interpretationPlaceholder;\n        const filterRange = this.filterRoot.querySelector(Selectors.filter.regions.range);\n        const discriminationSelect = document.getElementById('discriminationselect');\n        discriminationSelect.addEventListener('change', (e) => {\n            if (e.target.value === 'interpretation') {\n                filterRange.setAttribute('class', 'd-none');\n                this.interpretation = true;\n                const dataSource = this.filterRoot.querySelector('#rangeValue1');\n                const inputHide = document.getElementById('rangeValue2');\n                if (inputHide !== null) {\n                    inputHide.setAttribute('class', 'd-none');\n                }\n\n                for (const [key, value] of Object.entries(INTERPRETATION.VALUES)) {\n                    let selectedOption;\n                    selectedOption = document.createElement('option');\n                    selectedOption.value = value;\n                    selectedOption.innerHTML = key;\n                    dataSource.append(selectedOption);\n                }\n                Autocomplete.enhance(\n                    dataSource,\n                    false,\n                    null,\n                    interpretationPlaceholder,\n                    false,\n                    true,\n                    null,\n                    true,\n                    {\n                        layout: 'core/local/filter/autocomplete_layout',\n                        selection: 'core/local/filter/autocomplete_selection',\n                    }\n                );\n            }\n            if (e.target.value === 'index') {\n                filterRange.removeAttribute('class');\n                this.interpretation = false;\n                const context = {\n                    placeholderone: placeholderOne,\n                    type: 'number'\n                };\n                if (this.rangetype === 2) {\n                    context.placeholdertwo = placeholderTwo;\n                }\n                this.displayRange(context);\n            }\n        });\n    }\n\n    /**\n     * Get the placeholder for range value one.\n     *\n     * @return {Promise} Promise resolving string\n     */\n    get placeholderOne() {\n        return getString('firstplaceholder', 'qbank_statistics');\n    }\n\n    /**\n     * Get the placeholder for range value two.\n     *\n     * @return {Promise} Promise resolving string\n     */\n    get placeholderTwo() {\n        return getString('secondplaceholder', 'qbank_statistics');\n    }\n\n    /**\n     * Get the placeholder for interpretation.\n     *\n     * @return {Promise} Promise resolving string\n     */\n    get interpretationPlaceholder() {\n        return getString('interpretationplaceholder', 'qbank_statistics');\n    }\n\n    /**\n     * Get selected option when interpretation selected.\n     *\n     * @returns {Number}\n     */\n    get selectedOption() {\n        return this.filterRoot.querySelector('div[data-active-value]').dataset.activeValue;\n    }\n\n    /**\n     * Get ranges when interpretation selected.\n     *\n     * @returns {Array}\n     */\n    get interpretationRanges() {\n        const range = INTERPRETATION.RANGES[this.selectedOption].split('-');\n        return [range[0], range[1]];\n    }\n\n    /**\n     * Get the list of raw values for this filter type.\n     *\n     * @returns {Array}\n     */\n    get rawValues() {\n        if (this.interpretation === true) {\n            if (this.selectedOption == 1) {\n                // After.\n                return [this.interpretationRanges[0]];\n            }\n            if (this.selectedOption == 5) {\n                // Before.\n                return [this.interpretationRanges[0]];\n            }\n            return this.interpretationRanges;\n        }\n        const rangeValue1 = document.getElementById('rangeValue1').value;\n        const values = [rangeValue1];\n        if (this.rangetype === 2) {\n            const rangeValue2 = document.getElementById('rangeValue2').value;\n            values.push(rangeValue2);\n        }\n        return values;\n    }\n\n    /**\n     * Get the type of range specified.\n     *\n     * @returns {Number}\n     */\n    get rangetype() {\n        if (this.interpretation === true) {\n            if (this.selectedOption == 1) {\n                // After.\n                return 0;\n            }\n            if (this.selectedOption == 5) {\n                // Before.\n                return 1;\n            }\n        }\n        return parseInt(this.filterRoot.querySelector(Selectors.filter.fields.range).value, 10);\n    }\n}\n"],"file":"discrimination.min.js"}