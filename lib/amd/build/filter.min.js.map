{"version":3,"sources":["../src/filter.js"],"names":["filterSet","applyCallback","activeFilters","courseid","CourseFilter","querySelector","Selectors","filterset","region","addEventListener","e","target","closest","actions","addRow","preventDefault","addFilterRow","applyFilters","updateTableFromFilter","resetFilters","removeAllFilters","cleanUrlParams","regions","filterlist","filter","remove","removeOrReplaceFilterRow","filterRegion","getFilterRegion","CustomEvents","define","events","accessibleChange","on","typeField","fields","type","value","addFilter","join","dataset","filterverb","pendingPromise","Pending","rownum","querySelectorAll","length","Templates","renderForPromise","then","html","js","newContentNodes","appendNodeContents","filterRow","typeList","data","forEach","contentNode","contentTypeList","innerHTML","updateFiltersOptions","result","resolve","catch","Notification","exception","filterType","filterDataNode","datasource","byName","initialFilterValues","filterJoin","filterRange","getFilterDataSource","Filter","GenericFilter","filterTypeClass","disabled","joinField","isNaN","name","refreshContent","filterCount","replaceFilterRow","removeFilterRow","hasFilterValue","removeFilterObject","getAvailableFilterLegends","filterLegends","index","innerText","rowNum","replaceNode","filterName","getFilterObject","tearDown","filters","options","option","classList","add","addRowButton","all","setAttribute","removeAttribute","filtermatch","Object","values","filterValue","updateUrlParams","queryString","location","search","urlParams","URLSearchParams","has","queryToObject","get","url","URL","href","query","objectToQuery","searchParams","set","history","pushState","cleanedUrl","replace","keys","map","key","encodeURIComponent","object","params","entries","param","parseInt","includes","split","maxFilters","document","typeListSelect","requests","Array","_","rowIndex","push","fetchedStrings","legendStrings"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Filter management.\n *\n * @module     core/filter\n * @copyright  2020 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport CourseFilter from 'core/local/filter/filtertypes/courseid';\nimport GenericFilter from 'core/local/filter/base';\nimport {get_strings as getStrings} from 'core/str';\nimport Notification from 'core/notification';\nimport Pending from 'core/pending';\nimport Selectors from 'core/local/filter/selectors';\nimport Templates from 'core/templates';\nimport CustomEvents from 'core/custom_interaction_events';\nimport jQuery from 'jquery';\n\nexport default class {\n\n    /**\n     * Initialise the filter on the element with the given filterSet and callback.\n     *\n     * @param {HTMLElement} filterSet The filter element.\n     * @param {Function} applyCallback Callback function when updateTableFromFilter\n     */\n    constructor(filterSet, applyCallback) {\n\n        this.filterSet = filterSet;\n        this.applyCallback = applyCallback;\n        // Keep a reference to all of the active filters.\n        this.activeFilters = {\n            courseid: new CourseFilter('courseid', filterSet),\n        };\n    }\n\n    /**\n     * Initialise event listeners to the filter.\n     */\n    init() {\n        // Add listeners for the main actions.\n        this.filterSet.querySelector(Selectors.filterset.region).addEventListener('click', e => {\n            if (e.target.closest(Selectors.filterset.actions.addRow)) {\n                e.preventDefault();\n\n                this.addFilterRow();\n            }\n\n            if (e.target.closest(Selectors.filterset.actions.applyFilters)) {\n                e.preventDefault();\n\n                this.updateTableFromFilter();\n            }\n\n            if (e.target.closest(Selectors.filterset.actions.resetFilters)) {\n                e.preventDefault();\n\n                this.removeAllFilters();\n                // Clean url parameters.\n                this.cleanUrlParams();\n            }\n        });\n\n        // Add the listener to remove a single filter.\n        this.filterSet.querySelector(Selectors.filterset.regions.filterlist).addEventListener('click', e => {\n            if (e.target.closest(Selectors.filter.actions.remove)) {\n                e.preventDefault();\n\n                this.removeOrReplaceFilterRow(e.target.closest(Selectors.filter.region), true);\n            }\n        });\n\n        // Add listeners for the filter type selection.\n        let filterRegion = jQuery(this.getFilterRegion());\n        CustomEvents.define(filterRegion, [CustomEvents.events.accessibleChange]);\n        filterRegion.on(CustomEvents.events.accessibleChange, e => {\n            const typeField = e.target.closest(Selectors.filter.fields.type);\n            if (typeField && typeField.value) {\n                const filter = e.target.closest(Selectors.filter.region);\n\n                this.addFilter(filter, typeField.value);\n            }\n        });\n\n        this.filterSet.querySelector(Selectors.filterset.fields.join).addEventListener('change', e => {\n            this.filterSet.dataset.filterverb = e.target.value;\n        });\n    }\n\n    /**\n     * Get the filter list region.\n     *\n     * @return {HTMLElement}\n     */\n    getFilterRegion() {\n        return this.filterSet.querySelector(Selectors.filterset.regions.filterlist);\n    }\n\n    /**\n     * Add an unselected filter row.\n     *\n     * @return {Promise}\n     */\n    addFilterRow() {\n        const pendingPromise = new Pending('core/filter:addFilterRow');\n        const rownum = 1 + this.getFilterRegion().querySelectorAll(Selectors.filter.region).length;\n        return Templates.renderForPromise('core/filter_row', {\"rownumber\": rownum})\n            .then(({html, js}) => {\n                const newContentNodes = Templates.appendNodeContents(this.getFilterRegion(), html, js);\n\n                return newContentNodes;\n            })\n            .then(filterRow => {\n                // Note: This is a nasty hack.\n                // We should try to find a better way of doing this.\n                // We do not have the list of types in a readily consumable format, so we take the pre-rendered one and copy\n                // it in place.\n                const typeList = this.filterSet.querySelector(Selectors.data.typeList);\n\n                filterRow.forEach(contentNode => {\n                    const contentTypeList = contentNode.querySelector(Selectors.filter.fields.type);\n\n                    if (contentTypeList) {\n                        contentTypeList.innerHTML = typeList.innerHTML;\n                    }\n                });\n\n                return filterRow;\n            })\n            .then(filterRow => {\n                this.updateFiltersOptions();\n\n                return filterRow;\n            })\n            .then(result => {\n                pendingPromise.resolve();\n\n                return result;\n            })\n            .catch(Notification.exception);\n    }\n\n    /**\n     * Get the filter data source node fro the specified filter type.\n     *\n     * @param {String} filterType\n     * @return {HTMLElement}\n     */\n    getFilterDataSource(filterType) {\n        const filterDataNode = this.filterSet.querySelector(Selectors.filterset.regions.datasource);\n\n        return filterDataNode.querySelector(Selectors.data.fields.byName(filterType));\n    }\n\n    /**\n     * Add a filter to the list of active filters, performing any necessary setup.\n     *\n     * @param {HTMLElement} filterRow\n     * @param {String} filterType\n     * @param {Array} initialFilterValues The initially selected values for the filter\n     * @param {String} filterJoin\n     * @param {String} filterRange\n     * @returns {Filter}\n     */\n    async addFilter(filterRow, filterType, initialFilterValues, filterJoin, filterRange) {\n        // Name the filter on the filter row.\n        filterRow.dataset.filterType = filterType;\n\n        const filterDataNode = this.getFilterDataSource(filterType);\n\n        // Instantiate the Filter class.\n        let Filter = GenericFilter;\n        if (filterDataNode.dataset.filterTypeClass) {\n            Filter = await import(filterDataNode.dataset.filterTypeClass);\n        }\n        this.activeFilters[filterType] = new Filter(filterType, this.filterSet, initialFilterValues, filterRange);\n\n        // Disable the select.\n        const typeField = filterRow.querySelector(Selectors.filter.fields.type);\n        typeField.value = filterType;\n        typeField.disabled = 'disabled';\n\n        const joinField = filterRow.querySelector(Selectors.filter.fields.join);\n        if (isNaN(filterJoin) === false) {\n            joinField.value = filterJoin;\n            joinField.disabled = 'disabled';\n        }\n\n        // Update the list of available filter types.\n        this.updateFiltersOptions();\n\n        return this.activeFilters[filterType];\n    }\n\n    /**\n     * Get the registered filter class for the named filter.\n     *\n     * @param {String} name\n     * @return {Object} See the Filter class.\n     */\n    getFilterObject(name) {\n        return this.activeFilters[name];\n    }\n\n    /**\n     * Remove or replace the specified filter row and associated class, ensuring that if there is only one filter row,\n     * that it is replaced instead of being removed.\n     *\n     * @param {HTMLElement} filterRow\n     * @param {Bool} refreshContent Whether to refresh the table content when removing\n     */\n    removeOrReplaceFilterRow(filterRow, refreshContent) {\n        const filterCount = this.getFilterRegion().querySelectorAll(Selectors.filter.region).length;\n        if (filterCount === 1) {\n            this.replaceFilterRow(filterRow, refreshContent);\n        } else {\n            this.removeFilterRow(filterRow, refreshContent);\n        }\n    }\n\n    /**\n     * Remove the specified filter row and associated class.\n     *\n     * @param {HTMLElement} filterRow\n     * @param {Bool} refreshContent Whether to refresh the table content when removing\n     */\n    async removeFilterRow(filterRow, refreshContent = true) {\n        const filterType = filterRow.querySelector(Selectors.filter.fields.type);\n        const hasFilterValue = !!filterType.value;\n\n        // Remove the filter object.\n        this.removeFilterObject(filterRow.dataset.filterType);\n\n        // Remove the actual filter HTML.\n        filterRow.remove();\n\n        // Update the list of available filter types.\n        this.updateFiltersOptions();\n\n        if (hasFilterValue && refreshContent) {\n            // Refresh the table if there was any content in this row.\n            this.updateTableFromFilter();\n        }\n\n        // Update filter fieldset legends.\n        const filterLegends = await this.getAvailableFilterLegends();\n\n        this.getFilterRegion().querySelectorAll(Selectors.filter.region).forEach((filterRow, index) => {\n            filterRow.querySelector('legend').innerText = filterLegends[index];\n        });\n\n    }\n\n    /**\n     * Replace the specified filter row with a new one.\n     *\n     * @param {HTMLElement} filterRow\n     * @param {Bool} refreshContent Whether to refresh the table content when removing\n     * @param {Number} rowNum The number used to label the filter fieldset legend (eg Row 1). Defaults to 1 (the first filter).\n     * @return {Promise}\n     */\n    replaceFilterRow(filterRow, refreshContent = true, rowNum = 1) {\n        // Remove the filter object.\n        this.removeFilterObject(filterRow.dataset.filterType);\n\n        return Templates.renderForPromise('core/filter_row', {\"rownumber\": rowNum})\n            .then(({html, js}) => {\n                const newContentNodes = Templates.replaceNode(filterRow, html, js);\n\n                return newContentNodes;\n            })\n            .then(filterRow => {\n                // Note: This is a nasty hack.\n                // We should try to find a better way of doing this.\n                // We do not have the list of types in a readily consumable format, so we take the pre-rendered one and copy\n                // it in place.\n                const typeList = this.filterSet.querySelector(Selectors.data.typeList);\n\n                filterRow.forEach(contentNode => {\n                    const contentTypeList = contentNode.querySelector(Selectors.filter.fields.type);\n\n                    if (contentTypeList) {\n                        contentTypeList.innerHTML = typeList.innerHTML;\n                    }\n                });\n\n                return filterRow;\n            })\n            .then(filterRow => {\n                this.updateFiltersOptions();\n\n                return filterRow;\n            })\n            .then(filterRow => {\n                // Refresh the table.\n                if (refreshContent) {\n                    return this.updateTableFromFilter();\n                } else {\n                    return filterRow;\n                }\n            })\n            .catch(Notification.exception);\n    }\n\n    /**\n     * Remove the Filter Object from the register.\n     *\n     * @param {string} filterName The name of the filter to be removed\n     */\n    removeFilterObject(filterName) {\n        if (filterName) {\n            const filter = this.getFilterObject(filterName);\n            if (filter) {\n                filter.tearDown();\n\n                // Remove from the list of active filters.\n                delete this.activeFilters[filterName];\n            }\n        }\n    }\n\n    /**\n     * Remove all filters.\n     *\n     * @returns {Promise}\n     */\n    removeAllFilters() {\n        const filters = this.getFilterRegion().querySelectorAll(Selectors.filter.region);\n        filters.forEach(filterRow => this.removeOrReplaceFilterRow(filterRow, false));\n\n        // Refresh the table.\n        return this.updateTableFromFilter();\n    }\n\n    /**\n     * Remove any empty filters.\n     */\n    removeEmptyFilters() {\n        const filters = this.getFilterRegion().querySelectorAll(Selectors.filter.region);\n        filters.forEach(filterRow => {\n            const filterType = filterRow.querySelector(Selectors.filter.fields.type);\n            if (!filterType.value) {\n                this.removeOrReplaceFilterRow(filterRow, false);\n            }\n        });\n    }\n\n    /**\n     * Update the list of filter types to filter out those already selected.\n     */\n    updateFiltersOptions() {\n        const filters = this.getFilterRegion().querySelectorAll(Selectors.filter.region);\n        filters.forEach(filterRow => {\n            const options = filterRow.querySelectorAll(Selectors.filter.fields.type + ' option');\n            options.forEach(option => {\n                if (option.value === filterRow.dataset.filterType) {\n                    option.classList.remove('hidden');\n                    option.disabled = false;\n                } else if (this.activeFilters[option.value]) {\n                    option.classList.add('hidden');\n                    option.disabled = true;\n                } else {\n                    option.classList.remove('hidden');\n                    option.disabled = false;\n                }\n            });\n        });\n\n        // Configure the state of the \"Add row\" button.\n        // This button is disabled when there is a filter row available for each condition.\n        const addRowButton = this.filterSet.querySelector(Selectors.filterset.actions.addRow);\n        const filterDataNode = this.filterSet.querySelectorAll(Selectors.data.fields.all);\n        if (filterDataNode.length <= filters.length) {\n            addRowButton.setAttribute('disabled', 'disabled');\n        } else {\n            addRowButton.removeAttribute('disabled');\n        }\n\n        if (filters.length === 1) {\n            this.filterSet.querySelector(Selectors.filterset.regions.filtermatch).classList.add('hidden');\n            this.filterSet.querySelector(Selectors.filterset.fields.join).value = 2;\n            this.filterSet.dataset.filterverb = 2;\n        } else {\n            this.filterSet.querySelector(Selectors.filterset.regions.filtermatch).classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Update the Dynamic table based upon the current filter.\n     *\n     * @return {Promise}\n     */\n    updateTableFromFilter() {\n        const pendingPromise = new Pending('core/filter:updateTableFromFilter');\n\n        const filters = {};\n        Object.values(this.activeFilters).forEach(filter => {\n            filters[filter.filterValue.name] = filter.filterValue;\n        });\n\n        this.updateUrlParams(filters);\n        if (this.applyCallback) {\n            this.applyCallback(filters, pendingPromise);\n        }\n    }\n\n    /**\n     * Load URL parameter.\n     *\n     * @return {Object} filters\n     */\n    loadUrlParams() {\n        const queryString = location.search;\n        const urlParams = new URLSearchParams(queryString);\n        if (urlParams.has('filter')) {\n            const filters = this.queryToObject(urlParams.get('filter'));\n            return filters;\n        }\n        return {};\n    }\n\n    /**\n     * Update URL Param based upon the current filter.\n     *\n     * @param {Object} filters Active filters.\n     */\n    updateUrlParams(filters) {\n        const url = new URL(location.href);\n        const query = this.objectToQuery(filters);\n        url.searchParams.set('filter', query);\n        history.pushState(filters, '', url);\n    }\n\n    /**\n     * Cleans URL parameters.\n     *\n     */\n    cleanUrlParams() {\n        const queryString = location.search;\n        const urlParams = new URLSearchParams(queryString);\n        if (urlParams.has('cmid')) {\n            const cleanedUrl = new URL(location.href.replace(location.search, ''));\n            cleanedUrl.searchParams.set('cmid', urlParams.get('cmid'));\n            history.pushState({}, '', cleanedUrl);\n        }\n\n        if (urlParams.has('courseid')) {\n            const cleanedUrl = new URL(location.href.replace(location.search, ''));\n            cleanedUrl.searchParams.set('courseid', urlParams.get('courseid'));\n            history.pushState({}, '', cleanedUrl);\n        }\n    }\n\n    /**\n     * Convert a nested object into query parameters.\n     *\n     * @param {Object} filters Active filters.\n     * @return {String}\n     */\n    objectToQuery(filters) {\n        return Object.keys(filters).map(key => {\n            let value = filters[key];\n            if (value !== null && typeof value === 'object') {\n                value = this.objectToQuery(value);\n            }\n            return `${key}=${encodeURIComponent(`${value}`.replace(/\\s/g, '_'))}`;\n        }).join('&');\n    }\n\n    /**\n     * Convert query parameters into object.\n     *\n     * @param {string} query Query representing filter object.\n     * @return {object}\n     */\n    queryToObject(query) {\n        const object = {};\n        const params = new URLSearchParams(query);\n        const entries = params.entries();\n        entries.forEach((value) => {\n            const param = value[0];\n            object[param] = !isNaN(params.get(param)) ? parseInt(params.get(param)) : params.get(param);\n            if (isNaN(object[param]) && object[param].includes('&')) {\n                object[param] = this.queryToObject(object[param]);\n            }\n            if (param == 'values') {\n                if (typeof object[param] == 'string' && object[param].includes('=')) {\n                    object[param] = [object[param].split('=')[1]];\n                } else {\n                    object[param] = Object.values(object[param]);\n                }\n            }\n        });\n        return object;\n    }\n\n    /**\n     * Fetch the strings used to populate the fieldset legends for the maximum number of filters possible.\n     *\n     * @return {array}\n     */\n    async getAvailableFilterLegends() {\n        const maxFilters = document.querySelector(Selectors.data.typeListSelect).length - 1;\n        let requests = [];\n\n        [...Array(maxFilters)].forEach((_, rowIndex) => {\n            requests.push({\n                \"key\": \"filterrowlegend\",\n                \"component\": \"core_user\",\n                // Add 1 since rows begin at 1 (index begins at zero).\n                \"param\": rowIndex + 1\n            });\n        });\n\n        const legendStrings = await getStrings(requests)\n            .then(fetchedStrings => {\n                return fetchedStrings;\n            })\n            .catch(Notification.exception);\n\n        return legendStrings;\n    }\n\n}\n"],"file":"filter.min.js"}