{"version":3,"sources":["../src/preview.js"],"names":["init","redirect","url","closeButton","document","getElementById","onclick","window","opener","location","href","close","setupQuestionForm","formElement","form","autocompleteOff","preventRepeatSubmission","removeClass","scrollToSavedPos","setAttribute","addEventListener","submit","classname","querySelectorAll","forEach","e","remove","matches","match","scrollTo"],"mappings":"uJAwBA,uD,OASoB,QAAPA,CAAAA,IAAO,CAACC,CAAD,CAAWC,CAAX,CAAmB,CACnC,GAAI,CAACD,CAAL,CAAe,CACX,GAAIE,CAAAA,CAAW,CAAGC,QAAQ,CAACC,cAAT,CAAwB,4BAAxB,CAAlB,CACAF,CAAW,CAACG,OAAZ,CAAsB,UAAM,CACxB,GAAsB,IAAlB,GAAAC,MAAM,CAACC,MAAX,CAA4B,CACxBC,QAAQ,CAACC,IAAT,CAAgBR,CACnB,CAFD,IAEO,CACHK,MAAM,CAACI,KAAP,EACH,CACJ,CACJ,CAEDC,CAAiB,CAAC,cAAD,CACpB,C,IAQKA,CAAAA,CAAiB,CAAG,SAACC,CAAD,CAAiB,CACvC,GAAIC,CAAAA,CAAI,CAAGV,QAAQ,CAACC,cAAT,CAAwBQ,CAAxB,CAAX,CACA,GAAIC,CAAJ,CAAU,CAENC,CAAe,CAACD,CAAD,CAAf,CAEAE,CAAuB,CAACF,CAAD,CAAvB,CAEAG,CAAW,CAAC,yBAAD,CAA4BH,CAA5B,CAAX,CAEAI,CAAgB,CAACJ,CAAD,CACnB,CACJ,C,CAQKC,CAAe,CAAG,SAACD,CAAD,CAAU,CAC9BA,CAAI,CAACK,YAAL,CAAkB,cAAlB,CAAkC,KAAlC,CACH,C,CAQKH,CAAuB,CAAG,SAACF,CAAD,CAAU,CACtCA,CAAI,CAACM,gBAAL,CAAsB,QAAtB,CAAgC,UAAW,CACvC,cAAE,IAAF,EAAQC,MAAR,CAAe,UAAW,CACtB,QACH,CAFD,EAGA,QACH,CALD,CAMH,C,CASKJ,CAAW,CAAG,SAACK,CAAD,CAAYR,CAAZ,CAAqB,CACrCA,CAAI,CAACS,gBAAL,CAAsBD,CAAtB,EAAiCE,OAAjC,CAAyC,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACC,MAAF,EAAJ,CAA1C,CACH,C,CASKR,CAAgB,CAAG,SAACJ,CAAD,CAAU,CAC/B,GAAIa,CAAAA,CAAO,CAAGpB,MAAM,CAACE,QAAP,CAAgBC,IAAhB,CAAqBkB,KAArB,CAA2B,oCAA3B,CAAiE,IAAjE,CAAd,CACA,GAAID,CAAJ,CAAa,CAGTpB,MAAM,CAACsB,QAAP,CAAgB,CAAhB,CAAmBF,CAAO,CAAC,CAAD,CAA1B,EACAb,CAAI,CAACM,gBAAL,CAAsB,kBAAtB,CAA0C,UAAM,CAC5Cb,MAAM,CAACsB,QAAP,CAAgB,CAAhB,CAAmBF,CAAO,CAAC,CAAD,CAA1B,CACH,CAFD,CAGH,CACJ,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for preview.\n *\n * @module     qbank_preview/preview\n * @copyright  2021 Catalyst IT Australia Pty Ltd\n * @author     Safat Shahin <safatshahin@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n\n/**\n * Set up the actions.\n *\n * @method init\n * @param {bool} redirect Redirect.\n * @param {string} url url to redirect.\n */\nexport const init = (redirect, url) => {\n    if (!redirect) {\n        let closeButton = document.getElementById('close-previewquestion-page');\n        closeButton.onclick = () => {\n            if (window.opener === null) {\n                location.href = url;\n            } else {\n                window.close();\n            }\n        };\n    }\n    // Set up the form to be displayed.\n    setupQuestionForm('responseform');\n};\n\n/**\n * Set up the form element to be displayed.\n *\n * @method setupQuestionForm\n * @param {string} formElement The form element.\n */\nconst setupQuestionForm = (formElement) => {\n    let form = document.getElementById(formElement);\n    if (form) {\n        // Turning off browser autocomplete.\n        autocompleteOff(form);\n        // Stop a question form being submitted more than once.\n        preventRepeatSubmission(form);\n        // Removes any '.questionflagsavebutton's, since we have JavaScript to toggle.\n        removeClass('.questionflagsavebutton', form);\n        // Scroll to the position indicated by scrollpos= in the URL, if it is there.\n        scrollToSavedPos(form);\n    }\n};\n\n/**\n * Set the autocomplete off.\n *\n * @method autocompleteOff\n * @param {object} form The form element.\n */\nconst autocompleteOff = (form) => {\n    form.setAttribute(\"autocomplete\", \"off\");\n};\n\n/**\n * Event handler to stop a question form being submitted more than once.\n *\n * @method preventRepeatSubmission\n * @param {object} form The form element.\n */\nconst preventRepeatSubmission = (form) => {\n    form.addEventListener(\"submit\", function() {\n        $(this).submit(function() {\n            return false;\n        });\n        return true;\n    });\n};\n\n/**\n *  Removes a class inside an element.\n *\n * @method removeClass\n * @param {string} classname Class name.\n * @param {object} form The form element.\n */\nconst removeClass = (classname, form) => {\n    form.querySelectorAll(classname).forEach(e => e.remove());\n};\n\n/**\n *  If there is a parameter like scrollpos=123 in the URL, scroll to that saved position.\n *  (Note: Moodle 4.0 and above do NOT support Internet Explorer 11 and below.)\n *\n * @method scrollToSavedPos\n * @param {object} form The form element.\n */\nconst scrollToSavedPos = (form) => {\n    let matches = window.location.href.match(/^.*[?&]scrollpos=(\\d*)(?:&|$|#).*$/, '$1');\n    if (matches) {\n        // DOMContentLoaded is the effective one here. I am leaving the immediate call to\n        // window.scrollTo in case it reduces flicker.\n        window.scrollTo(0, matches[1]);\n        form.addEventListener(\"DOMContentLoaded\", () => {\n            window.scrollTo(0, matches[1]);\n        });\n    }\n};\n"],"file":"preview.min.js"}