define ("qbank_managecategories/order_categories",["exports","core/ajax","core/notification","core/sortable_list","jquery"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=f(b);c=f(c);d=f(d);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function h(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}var i=function a(){var f=this;g(this,a);h(this,"setupSortableLists",function(){new d.default(".category_list",{moveHandlerSelector:".list_item [data-drag-type=move]"});(0,e.default)(".list_item").on(d.default.EVENTS.DROP,function(a){a.stopPropagation();var b=(0,e.default)(".list_item").parent(),c=a.currentTarget.getElementsByTagName("a")[0].href,d=c.substr(c.search("\\?")),g=new URLSearchParams(d),h=g.get("cat"),i=h.substr(h.search(",")+1),j=h.substr(0,h.search(","));(0,e.default)("li.list_item[style]").remove();var k=f.getNewOrder(b,i,j),l=JSON.stringify(k[0]),m=k[1].split(","),n=k[2].split(","),o=m[1],p=n[1],q=n[0];f.setCatOrder(l,q,o,p).then(function(){return location.reload()}).catch(function(){return location.reload()})})});h(this,"setCatOrder",function(a,d,e,f){var g=new Promise(function(g,h){var i=b.default.call([{methodname:"qbank_managecategories_update_category_order",args:{neworder:a,origincategory:d,destinationcontext:e,origincontext:f},fail:c.default.exception}]);i[0].then(function(a){if(!0===JSON.parse(a)){g()}else{h()}})});return g});h(this,"getNewOrder",function(a,b,c){for(var d=c+","+b,e=[],f=[],g=0;g<a.length;g++){for(var h=a[g].querySelectorAll("li.list_item"),k=[],l=0;l<h.length;l++){var m=h[l].getElementsByTagName("a")[0].href,n=m.substr(m.search("\\?")),o=new URLSearchParams(n),p=o.get("cat"),q=p.substr(p.search(",")+1);p=p.substr(0,p.search(","));k[l]=p+","+q;if(k[l]===d){f.push(k)}}e[g]=k}f=f[0];f=f.filter(function(a){return a!==d});return[e,f[0],d]})},j=function(){var a=document.getElementsByName("qbshowdescr")[0],b=document.getElementById("qbshowdescr-form");if(a!==void 0){a.addEventListener("click",function(a){a.preventDefault();b.submit()})}};a.init=function init(){j();var a=new i;a.setupSortableLists()}});
//# sourceMappingURL=order_categories.min.js.map
