define ("qbank_managecategories/order_categories",["exports","jquery","core/ajax","core/fragment","core/notification","core/sortable_list","core/templates"],function(a,b,c,d,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=i(b);c=i(c);d=i(d);f=i(f);g=i(g);h=i(h);function i(a){return a&&a.__esModule?a:{default:a}}new g.default(".category_list",{moveHandlerSelector:".list_item [data-drag-type=move]"});var j=function(a){(0,b.default)(".list_item").on(g.default.EVENTS.DROP,function(c){c.stopPropagation();var d=(0,b.default)(".list_item").parent(),e=c.currentTarget.getElementsByTagName("a")[0].href,g=e.substr(e.search("\\?")),i=new URLSearchParams(g),j=i.get("cat"),n=j.substr(j.search(",")+1),o=j.substr(0,j.search(","));(0,b.default)("li.list_item[style]").remove();var p=m(d,n,o),q=JSON.stringify(p[0]),r=n;if(p[1]!==void 0){var v=p[1].split(",");r=v[1]}var s=p[2].split(","),t=s[1],u=s[0];l(q,u,r,t).then(function(){return k(a).done(function(a,b){h.default.replaceNodeContents("#categoriesrendered",a,b)})}).catch(function(b){f.default.addNotification({message:b.error,type:"error"});return k(a).done(function(a,b){document.getElementsByClassName("alert-danger")[0].scrollIntoView();h.default.replaceNodeContents("#categoriesrendered",a,b)})})})},k=function(a){var b={url:location.href};return d.default.loadFragment("qbank_managecategories","category_rendering",a,b)},l=function(a,b,d,e){var g=new Promise(function(g,h){var i=c.default.call([{methodname:"qbank_managecategories_update_category_order",args:{neworder:a,origincategory:b,destinationcontext:d,origincontext:e},fail:f.default.exception}]);i[0].then(function(a){if(!0===a.success){g()}else{h(a)}}).catch(function(){})});return g},m=function(a,b,c){for(var d=c+","+b,e=[],f=[],g=0;g<a.length;g++){for(var h=a[g].querySelectorAll("li.list_item"),k=[],l=0;l<h.length;l++){var m=h[l].getElementsByTagName("a")[0].href,n=m.substr(m.search("\\?")),o=new URLSearchParams(n),p=o.get("cat");k[l]=p;if(p===d){f.push(k)}}e[g]=k}f=f[0];f=f.filter(function(a){return a.split(",")[1]!=b});return[e,f[0],d]},n=function(a){var b=document.getElementById("categoriesrendered");if(b){b.addEventListener("click",function(b){if(b.target.parentNode.classList.contains("action-icon")){var d=b.target.parentNode.dataset,e=c.default.call([{methodname:"qbank_managecategories_update_category_order",args:{origincategory:d.tomove,tocategory:d.tocategory},fail:f.default.exception}]);e[0].then(function(){k(a).done(function(a,b){h.default.replaceNodeContents("#categoriesrendered",a,b)})}).catch(function(){})}})}};a.init=function init(a){n(a);j(a)}});
//# sourceMappingURL=order_categories.min.js.map
