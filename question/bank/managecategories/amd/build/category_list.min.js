define("qbank_managecategories/category_list",["exports","core/ajax","core/fragment","core/notification","core/templates"],(function(_exports,_ajax,_fragment,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Javascript module handling ordering of categories.
   *
   * @module     qbank_managecategories
   * @copyright  2021 Catalyst IT Australia Pty Ltd
   * @author     Ghaly Marc-Alexandre <marc-alexandreghaly@catalyst-ca.net>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   *
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_fragment=_interopRequireDefault(_fragment),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);const SELECTORS_CATEGORY_ITEM=".category_list .list_item",SELECTORS_BUTTON="[role=button]",getCategoriesFragment=contextid=>{let params={url:location.href};return _fragment.default.loadFragment("qbank_managecategories","category_rendering",contextid,params)},setCatOrder=(origincategory,insertaftercategory,pagecontextid)=>{const call={methodname:"qbank_managecategories_update_category_order",args:{origincategory:origincategory,insertaftercategory:insertaftercategory}};_ajax.default.call([call])[0].then((()=>getCategoriesFragment(pagecontextid))).catch((error=>{var _document$getElements;return _notification.default.addNotification({message:error.message,type:"error"}),null===(_document$getElements=document.getElementsByClassName("alert-danger")[0])||void 0===_document$getElements||_document$getElements.scrollIntoView(),getCategoriesFragment(pagecontextid)})).then(((html,js)=>{_templates.default.replaceNode("#categoriesrendered",html,js)})).catch(_notification.default.exception)};_exports.init=pagecontextid=>{(pagecontextid=>{document.addEventListener("click",(e=>{if(!e.target.closest("#categoriesrendered"))return;const actionIcon=e.target.closest(".action-icon");if(!actionIcon)return;const data=actionIcon.dataset,call={methodname:"qbank_managecategories_update_category_order",args:{origincategory:data.tomove,newparentcategory:data.tocategory}};_ajax.default.call([call])[0].then((()=>getCategoriesFragment(pagecontextid))).then(((html,js)=>{_templates.default.replaceNode("#categoriesrendered",html,js)})).catch(_notification.default.exception)}))})(pagecontextid),(pagecontextid=>{const listitems=document.querySelectorAll(SELECTORS_CATEGORY_ITEM);let sourceid;const getTouchTarget=e=>document.elementFromPoint(e.changedTouches[0].pageX,e.changedTouches[0].pageY).closest(SELECTORS_CATEGORY_ITEM),handleDragStart=e=>{if(e.target.closest(SELECTORS_BUTTON))return;let target;target="touchstart"==e.type?getTouchTarget(e):e.target.closest(SELECTORS_CATEGORY_ITEM),e.cancelable&&e.preventDefault(),sourceid=target.id},handleDrag=e=>{if(e.target.closest(SELECTORS_BUTTON))return;let target;target="touchmove"==e.type?getTouchTarget(e):e.target.closest(SELECTORS_CATEGORY_ITEM),target&&sourceid&&(e.cancelable&&e.preventDefault(),listitems.forEach((item=>{item.classList.remove("border-danger")})),target.classList.add("border-danger"))},handleDragEnd=e=>{if(e.target.closest(SELECTORS_BUTTON))return;let target;if(target="touchend"==e.type?getTouchTarget(e):e.target.closest(SELECTORS_CATEGORY_ITEM),!target)return;if(e.cancelable&&e.preventDefault(),!sourceid||sourceid==target.id)return;const source=document.getElementById(sourceid);if(!source)return;sourceid=null,target.closest(".category_list").insertBefore(source,target.nextSibling);const originCategory=source.dataset.categoryid,insertaftercategory=target.dataset.categoryid;setCatOrder(originCategory,insertaftercategory,pagecontextid)};listitems.forEach((item=>{item.addEventListener("touchstart",handleDragStart),item.addEventListener("touchmove",handleDrag),item.addEventListener("touchend",handleDragEnd),item.addEventListener("mousedown",handleDragStart),item.addEventListener("mousemove",handleDrag),item.addEventListener("mouseup",handleDragEnd)}))})(pagecontextid),document.addEventListener("click",(e=>{const checkbox=e.target.closest('[name="qbshowdescr"]');checkbox&&checkbox.form.submit()}))}}));

//# sourceMappingURL=category_list.min.js.map